# Tello Scratch ドローンショー・コントローラー

Scratchプロジェクトから生成されたタイムラインに基づいてTelloドローンのショーを制御するアプリケーションです。

## 📁 プロジェクト構造

```
src/
├── config.py                  # 設定管理（定数、色、フォント等）
├── tello_controller.py        # Telloドローン制御クラス
├── scratch_parser.py          # Scratchプロジェクト解析クラス
├── show_runner.py             # ドローンショー実行ロジック
├── music_player.py            # 音楽プレイヤーモジュール
├── debug_parser.py            # デバッグ用パーサー
├── gui/
│   ├── __init__.py
│   └── main_window.py         # GUIアプリケーション
└── main.py                    # アプリケーションエントリーポイント

old-ver/
└── 2025_10_27/
    └── tello_gui_app.py       # レガシー版（単一ファイル）
```

## 🎯 モジュール概要

### config.py
アプリケーション全体で使用される定数と設定値を管理します。
- フォント設定
- 色設定
- ウィンドウ設定
- ファイル形式定義
- ログレベル定義

### tello_controller.py
Telloドローンとの通信を管理します。
- UDP通信による制御
- コマンド送信・応答受信
- エラーハンドリング

### scratch_parser.py
Scratchプロジェクト（.sb3）を解析します。
- プロジェクトファイルの読み込み
- ブロックの解析
- タイムライン生成

### show_runner.py
ドローンショーの実行を管理します。
- 複数ドローンの同期制御
- タイムライン実行
- 緊急停止処理

### music_player.py
ドローンショーと同期して音楽を再生します。
- pygame を使用した音楽再生
- 遅延再生機能
- 再生制御（停止、一時停止、音量調整）

### gui/main_window.py
メインウィンドウのGUIを提供します。
- ドローン設定UI
- プロジェクト選択・解析UI
- 音楽ファイル選択UI
- ショー制御UI
- タイムライン・ログ表示

### main.py
アプリケーションのエントリーポイントです。
- DPI設定
- アプリケーション起動

## 🚀 実行方法

### 実行
```bash
cd src
python main.py
```

### レガシー版で実行（参考用）
```bash
cd old-ver/2025_10_27
python tello_gui_app.py
```

## 📦 依存関係

- Python 3.7+
- tkinter（標準ライブラリ）
- pygame（音楽再生機能用）

音楽再生機能を使用する場合：
```bash
pip install pygame
```

## ✨ 主な機能

1. **ドローン設定**
   - 複数ドローンのIPアドレス管理
   - 設定の保存・読み込み

2. **プロジェクト解析**
   - Scratchプロジェクト（.sb3）の読み込み
   - タイムライン自動生成
   - プレビュー表示

3. **音楽再生**
   - MP3、WAV、OGG形式に対応
   - ショーと同期した自動再生
   - 遅延再生機能

4. **ショー制御**
   - ドローン接続管理
   - ショー開始・停止
   - 緊急停止機能

5. **リアルタイム表示**
   - タイムラインハイライト
   - 通信ログ表示
   - ステータス更新

## 🎨 改善点

### コード品質
- **モジュール分割**: 単一ファイルから複数モジュールへ
- **可読性向上**: 適切な命名、docstring、コメント
- **保守性向上**: 各モジュールの責務が明確
- **拡張性向上**: 新機能追加が容易

### 設定管理
- 定数を`config.py`に集約
- マジックナンバーの排除
- 設定変更が容易

### UI/UX
- モジュール化されたUI構築
- 段階的なウィジェット作成
- タグ設定の一元管理

## 📝 開発ガイドライン

### 新機能の追加
1. 該当するモジュールを特定
2. 必要に応じて新しいモジュールを作成
3. `config.py`に設定を追加
4. `main_window.py`にUI要素を追加

### テスト
各モジュールは独立しているため、単体テストが容易です：
```python
# 例: scratch_parser.py のテスト
from scratch_parser import ScratchProjectParser
parser = ScratchProjectParser("test.sb3", None)
schedule, total_time = parser.parse_to_schedule()
```

## 📄 ライセンス

このプロジェクトは教育目的で作成されています。

## 🤝 貢献

改善提案やバグレポートは歓迎します。

## 📞 サポート

問題が発生した場合は、以下を確認してください：
1. Python バージョン（3.7+）
2. 必要なライブラリのインストール
3. ドローンのIPアドレス設定
4. Scratchプロジェクトの形式
